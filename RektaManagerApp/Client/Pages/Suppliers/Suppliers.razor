@page "/suppliers"
@using RektaManagerApp.Shared
@inject IHttpService HttpService
@inject NavigationManager Navigation


<h3>Suppliers</h3>

<div class="pb-4 mb-4">
    <span>
        <button @onclick="@(() => Navigation.NavigateTo("suppliers/create"))" class="btn btn-outline-info">
            <span class="bi bi-plus-circle-fill"></span>
            Create Supplier
        </button>
    </span>
</div>

<div class="pt-2">
    <SfGrid DataSource="@_suppliers" AllowSorting="true" AllowPaging="true">
        <GridPageSettings PageSize="10"></GridPageSettings>
        <GridColumns>
            <GridColumn Field="@nameof(Supplier.Id)" HeaderText="Supplier ID" TextAlign="TextAlign.Center" AllowSorting="false"></GridColumn>
            <GridColumn Field="@nameof(Supplier.Name)" TextAlign="TextAlign.Center"></GridColumn>
            <GridColumn Field="@nameof(Supplier.PhoneNumber)" TextAlign="TextAlign.Center"></GridColumn>
            <GridColumn Field="@nameof(Supplier.SupplierBills.Count)" HeaderText="Bills Submitted" TextAlign="TextAlign.Center"></GridColumn>
            <GridColumn Field="@nameof(Supplier.SuppliedProducts.Count)" HeaderText="Products Supplied" TextAlign="TextAlign.Center"></GridColumn>
            <GridColumn>
                <Template>
                    @{
                        var supplier = (context as Supplier);
                        <a href="inventory/details/@supplier.Id" class="btn btn-outline-info"><span class="bi bi-eye-fill"></span></a>
                        <a href="inventory/edit/@supplier.Id" class="btn btn-outline-info"><span class="bi bi-pencil-square"></span></a>
                        <button class="btn btn-outline-danger" @onclick="@(() => DeleteSupplier(@supplier.Id))">
                            <span class="bi bi-trash2-fill"></span>
                            <span style="display: @_spinnerShow"><ActionSpinner ActionName="Deleting" ColorVariant="text-dark" /></span>
                        </button>
                    }
                </Template>
            </GridColumn>
        </GridColumns>
    </SfGrid>
</div>

@code {

    IEnumerable<Supplier> _suppliers = new List<Supplier>();
    string _spinnerShow = "none";
    
    
    protected override async Task OnInitializedAsync()
    {
        var result = await HttpService.GetAsync<IEnumerable<Supplier>>("/api/suppliers");

        _suppliers = result.Response;
        Console.WriteLine(_suppliers.Count());
    }

    async Task DeleteSupplier(int id)
    {
        _spinnerShow = "inline";
        await Task.Delay(5000);
        _spinnerShow = "none";
    }

}
